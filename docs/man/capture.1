.\" Automatically generated by Pandoc 3.1.2
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "TRACEE-CAPTURE" "1" "2023/10" "" "Tracee Capture Flag Manual"
.hy
.SS NAME
.PP
tracee \f[B]--capture\f[R] - Capture artifacts that were written,
executed, or found to be suspicious
.SS SYNOPSIS
.PP
tracee \f[B]--capture\f[R] <[artifact:]capture-option[=value]> \&...
.PP
tracee \f[B]--capture\f[R] <network> [\f[B]--capture\f[R]
[pcap:option1(,option2\&...)|pcap-options:option|pcap-snaplen:size]]
\&...
.SS DESCRIPTION
.PP
The \f[B]--capture\f[R] flag allows you to capture artifacts that were
written, executed, or found to be suspicious during the execution of
Tracee.
The captured artifacts will appear in the `output-path' directory.
.PP
Possible capture options:
.IP \[bu] 2
\f[B][artifact:]write[=/path/prefix*]\f[R]: Capture written files.
You can provide a filter to only capture file writes whose path starts
with a certain prefix (up to 50 characters).
Up to 3 filters can be given.
.IP \[bu] 2
\f[B][artifact:]read[=/path/prefix*]\f[R]: Capture read files.
You can provide a filter to only capture file reads whose path starts
with a certain prefix (up to 50 characters).
Up to 3 filters can be given.
.IP \[bu] 2
\f[B][artifact:]exec\f[R]: Capture executed files.
.IP \[bu] 2
\f[B][artifact:]module\f[R]: Capture loaded kernel modules.
.IP \[bu] 2
\f[B][artifact:]bpf\f[R]: Capture loaded BPF programs bytecode.
.IP \[bu] 2
\f[B][artifact:]mem\f[R]: Capture memory regions that had write+execute
(w+x) protection and then changed to execute (x) only.
.IP \[bu] 2
\f[B][artifact:]network\f[R]: Capture network traffic.
Only TCP/UDP/ICMP protocols are currently supported.
.SS File Capture Filters
.PP
Files captured upon read/write can be filtered to catch only specific IO
operations.
The different filter types have a logical `AND' between them but a
logical `OR' between filters of the same type.
The filter format is as follows:
<read/write>:<filter-type>=<filter-value>
.PP
Filter types:
.IP \[bu] 2
\f[B]path\f[R]: A filter for the file path prefix (up to 50 characters).
Up to 3 filters can be given.
Identical to using `<read/write>=/path/prefix*'.
.IP \[bu] 2
\f[B]type\f[R]: A file type from the following options: `regular',
`pipe', and `socket'.
.IP \[bu] 2
\f[B]fd\f[R]: The file descriptor of the file.
Can be one of the three standards: `stdin', `stdout', and `stderr'.
.SS Network Capture Notes
.IP \[bu] 2
Pcap Files:
.RS 2
.IP \[bu] 2
If you only specify \f[B]--capture network\f[R], you will have a single
file with all network traffic.
.IP \[bu] 2
You can use \f[B]pcap:xxx,yyy\f[R] to have more than one pcap file,
split by different means.
.RE
.IP \[bu] 2
Pcap Options:
.RS 2
.IP \[bu] 2
If you do not specify \f[B]pcap-options\f[R] (or set to none), you will
capture ALL network traffic into your pcap files.
.IP \[bu] 2
If you specify \f[B]pcap-options:filtered\f[R], events being traced will
define what network traffic will be captured.
.RE
.IP \[bu] 2
Snap Length:
.RS 2
.IP \[bu] 2
If you do not specify a snaplen, the default is headers only (incomplete
packets in tcpdump).
.IP \[bu] 2
If you specify \f[B]max\f[R] as snaplen, you will get the full contents
of each packet (pcap files will be large).
.IP \[bu] 2
If you specify \f[B]headers\f[R] as snaplen, you will only get L2/L3
headers in captured packets.
.IP \[bu] 2
If you specify \f[B]headers\f[R] but trace for \f[B]net_packet_dns\f[R]
events, the L4 DNS header will be captured.
.IP \[bu] 2
If you specify \f[B]headers\f[R] but trace for \f[B]net_packet_http\f[R]
events, only L2/L3 headers will be captured.
.RE
.SS EXAMPLES
.SS File capture
.IP \[bu] 2
To capture executed files into the default output directory, use the
following flag:
.RS 2
.IP
.nf
\f[C]
--capture exec
\f[R]
.fi
.RE
.IP \[bu] 2
To capture executed files into a specific directory, clear the directory
before starting, use the following flags:
.RS 2
.IP
.nf
\f[C]
--capture exec --capture dir:/my/dir --capture clear-dir
\f[R]
.fi
.RE
.IP \[bu] 2
To capture files that were written into anywhere under /usr/bin/ or
/etc/, use the following flags:
.RS 2
.IP
.nf
\f[C]
--capture write=/usr/bin/* --capture write=/etc/*
\f[R]
.fi
.RE
.IP \[bu] 2
To capture file writes to socket files that are the `stdout' of the
writing process, use the following flag:
.RS 2
.IP
.nf
\f[C]
--capture write:type=socket --capture write:fd=stdout
\f[R]
.fi
.RE
.SS Network Capture
.IP \[bu] 2
To capture network traffic, use the following flag:
.RS 2
.IP
.nf
\f[C]
--capture network
\f[R]
.fi
.RE
.IP \[bu] 2
To capture network traffic and save separate pcap files for processes
and commands, use the following flag:
.RS 2
.IP
.nf
\f[C]
--capture network --capture pcap:process,command
\f[R]
.fi
.RE
.IP \[bu] 2
To capture network traffic and save pcap files containing only
traced/filtered packets, use the following flag:
.RS 2
.IP
.nf
\f[C]
--capture network --capture pcap-options:filtered
\f[R]
.fi
.RE
.IP \[bu] 2
To capture network traffic and set the captured payload from each packet
to 1KB, use the following flag:
.RS 2
.IP
.nf
\f[C]
--capture network --capture pcap-snaplen:1kb
\f[R]
.fi
.RE
.IP \[bu] 2
To capture network traffic and save pcap files for containers and
commands, use the following flag:
.RS 2
.IP
.nf
\f[C]
--capture network --capture pcap:container,command
\f[R]
.fi
.RE
