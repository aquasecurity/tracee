.\" Automatically generated by Pandoc 3.2
.\"
.TH "" "" "" "" ""
.SH dns_request_kernel(1)
.SS NAME
dns_request_kernel \- Kernel\-level DNS request capture event
.SS DESCRIPTION
The \f[B]dns_request_kernel\f[R] event shows DNS queries captured at the
kernel level.
Check net_packet_dns.md for more information on DNS.
This event provides a \f[B]simple, reliable, and efficient\f[R]
alternative to network packet\-based DNS monitoring.
Unlike the complex network event infrastructure that relies on packet
capture and filtering, this event uses a direct kernel hook on the
\f[CR]udp_sendmsg\f[R] function, making it more reliable and performant.
.PP
DNS queries come in various types, each serving a specific purpose in
the domain name resolution process or in retrieving information from DNS
servers:
.IP \[bu] 2
\f[B]Standard Query (A or AAAA)\f[R]: Requests IPv4 (A) or IPv6 (AAAA)
address associated with a given domain name
.IP \[bu] 2
\f[B]Inverse Query (PTR)\f[R]: Provides an IP address and asks for the
associated domain name (PTR record)
.IP \[bu] 2
\f[B]Mail Exchange Query (MX)\f[R]: Retrieves mail exchange servers
responsible for receiving email for a specific domain
.IP \[bu] 2
\f[B]Name Server Query (NS)\f[R]: Discovers the authoritative name
servers for a domain
.IP \[bu] 2
\f[B]Start of Authority Query (SOA)\f[R]: Retrieves SOA record
containing essential information about the domain
.IP \[bu] 2
\f[B]Service Query (SRV)\f[R]: Locates services associated with a
specific domain (SIP, XMPP, LDAP)
.IP \[bu] 2
\f[B]Text Query (TXT)\f[R]: Retrieves text\-based information associated
with a domain
.IP \[bu] 2
\f[B]Canonical Name Query (CNAME)\f[R]: Finds the canonical (true) name
of an alias domain
.IP \[bu] 2
\f[B]Pointer Query (PTR) for IPv6\f[R]: Similar to PTR queries for IPv4,
but for IPv6 addresses
.IP \[bu] 2
\f[B]Wildcard Query\f[R]: Uses \[cq]*\[cq] character to match multiple
subdomains or hostnames within a domain
.PP
\f[B]Key Features:\f[R] \- \f[B]Kernel\-level monitoring\f[R]: Captures
DNS requests at the kernel level by hooking the \f[CR]udp_sendmsg\f[R]
function \- \f[B]Port\-based filtering\f[R]: Only captures UDP packets
destined for port 53 (DNS) \- \f[B]Multiple data formats\f[R]: Supports
both iovec and ubuf message formats \- \f[B]DNS parsing\f[R]:
Automatically parses DNS messages to extract hostname and query type
information \- \f[B]Process context\f[R]: Provides full process context
including process name, PID, and other metadata
.PP
\f[B]Advantages:\f[R] \- \f[B]Reliability\f[R]: Direct kernel hooking
provides more consistent event generation compared to network packet
capture \- \f[B]Performance\f[R]: Efficient kernel\-level monitoring
without network packet processing overhead \- \f[B]Simplicity\f[R]:
Straightforward implementation without complex network infrastructure
dependencies \- \f[B]Early detection\f[R]: Captures DNS requests before
they leave the system \- \f[B]Process attribution\f[R]: Provides clear
process context for each DNS request \- \f[B]Kernel\-level
accuracy\f[R]: Not affected by network\-level filtering or NAT
.PP
\f[B]Limitations:\f[R] \- \f[B]UDP only\f[R]: Only captures UDP\-based
DNS requests (not TCP DNS) \- \f[B]Single iovec node\f[R]: Currently
supports only the first iovec node in multi\-node vectors \- \f[B]Kernel
version dependency\f[R]: Requires specific kernel features for iov_iter
handling
.SS EVENT SETS
This event is included in the following event sets:
.IP \[bu] 2
\f[B]network_events\f[R]: Network\-related events
.SS DATA FIELDS
.TP
\f[B]hostname\f[R] (\f[I]string\f[R])
The domain name being queried (e.g., \[lq]google.com\[rq])
.TP
\f[B]query_type\f[R] (\f[I]string\f[R])
The type of DNS query (e.g., \[lq]A\[rq], \[lq]AAAA\[rq], \[lq]MX\[rq],
\[lq]TXT\[rq])
.SS DEPENDENCIES
\f[B]Kernel Hooks:\f[R]
.IP \[bu] 2
udp_sendmsg: KProbe hook on the \f[CR]udp_sendmsg\f[R] kernel function
to capture UDP packets being sent to port 53.
This function is called whenever a process attempts to send a UDP
packet, making it an ideal interception point for DNS requests.
.PP
The hook performs several key operations: 1.
\f[B]Port filtering\f[R]: Checks if the destination port is 53 (DNS) 2.
\f[B]Message format detection\f[R]: Determines whether the message uses
iovec or ubuf format 3.
\f[B]Data extraction\f[R]: Captures the DNS payload from the appropriate
message format 4.
\f[B]Process context\f[R]: Records the calling process information
.SS USE CASES
.IP \[bu] 2
\f[B]High\-performance environments\f[R]: When you need efficient DNS
monitoring without network packet processing overhead
.IP \[bu] 2
\f[B]Reliable monitoring\f[R]: When you require consistent event
generation without dependency on network infrastructure
.IP \[bu] 2
\f[B]Security monitoring\f[R]: Detecting suspicious DNS queries or data
exfiltration attempts with guaranteed process attribution
.IP \[bu] 2
\f[B]Network troubleshooting\f[R]: Understanding which processes are
making DNS requests with kernel\-level accuracy
.IP \[bu] 2
\f[B]Compliance\f[R]: Auditing DNS activity for regulatory requirements
with reliable event capture
.IP \[bu] 2
\f[B]Performance analysis\f[R]: Identifying DNS\-related performance
issues without the overhead of packet capture
.SS RELATED EVENTS
.IP \[bu] 2
\f[B]net_packet_dns\f[R]: General DNS packet events (both requests and
responses)
.IP \[bu] 2
\f[B]net_packet_dns_request\f[R]: Network packet\-based DNS request
monitoring (more complex, relies on network infrastructure)
.IP \[bu] 2
\f[B]net_packet_dns_response\f[R]: DNS response monitoring (network
packet\-based)
.SS EXAMPLE
.IP
.EX
$ tracee \-\-output json \-\-events dns_request_kernel
.EE
.PP
The event captures DNS queries with detailed process context and DNS
query information:
.IP
.EX
{
  \[dq]timestamp\[dq]: 1696255905516744399,
  \[dq]threadStartTime\[dq]: 1695658999333342363,
  \[dq]processorId\[dq]: 4,
  \[dq]processId\[dq]: 1234,
  \[dq]cgroupId\[dq]: 2626,
  \[dq]threadId\[dq]: 1234,
  \[dq]parentProcessId\[dq]: 1,
  \[dq]hostProcessId\[dq]: 1234,
  \[dq]hostThreadId\[dq]: 1234,
  \[dq]hostParentProcessId\[dq]: 1,
  \[dq]userId\[dq]: 976,
  \[dq]mountNamespace\[dq]: 4026532555,
  \[dq]pidNamespace\[dq]: 4026531836,
  \[dq]processName\[dq]: \[dq]systemd\-resolve\[dq],
  \[dq]executable\[dq]: {\[dq]path\[dq]: \[dq]\[dq]},
  \[dq]hostName\[dq]: \[dq]example\-host\[dq],
  \[dq]containerId\[dq]: \[dq]\[dq],
  \[dq]container\[dq]: {},
  \[dq]kubernetes\[dq]: {},
  \[dq]eventId\[dq]: \[dq]2008\[dq],
  \[dq]eventName\[dq]: \[dq]dns_request_kernel\[dq],
  \[dq]matchedPolicies\[dq]: [\[dq]\[dq]],
  \[dq]argsNum\[dq]: 2,
  \[dq]returnValue\[dq]: 0,
  \[dq]syscall\[dq]: \[dq]write\[dq],
  \[dq]stackAddresses\[dq]: [0],
  \[dq]contextFlags\[dq]: {\[dq]containerStarted\[dq]: \f[B]false\f[R], \[dq]isCompat\[dq]: \f[B]false\f[R]},
  \[dq]threadEntityId\[dq]: 131662446,
  \[dq]processEntityId\[dq]: 131662446,
  \[dq]parentEntityId\[dq]: 1975426032,
  \[dq]args\[dq]: [
    {\[dq]name\[dq]: \[dq]hostname\[dq], \[dq]type\[dq]: \[dq]string\[dq], \[dq]value\[dq]: \[dq]google.com\[dq]},
    {\[dq]name\[dq]: \[dq]query_type\[dq], \[dq]type\[dq]: \[dq]string\[dq], \[dq]value\[dq]: \[dq]A\[dq]}
  ]
}
.EE
.PP
Choose \f[CR]dns_request_kernel\f[R] when you need reliable event
generation without network infrastructure dependencies, better
performance by avoiding packet capture overhead, simpler implementation
with direct kernel hooking, and guaranteed process attribution at the
kernel level.
.PP
Choose network packet events when you need DNS response monitoring (this
event only captures requests), TCP\-based DNS monitoring (this event
only captures UDP), or network\-level packet analysis and filtering.
