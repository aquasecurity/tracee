
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Runtime security and forensics using eBPF.">
      
      
      
        <link rel="canonical" href="https://aquasecurity.github.io/tracee/dev/building/nocore-ebpf/">
      
      
        
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.8+insiders-4.6.1">
    
    
      
        <title>Building non CO-RE - Tracee</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bfcc4ef8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
      <link rel="preload" as="style" href="../../assets/stylesheets/vendor/mermaid.d607d465.min.css">
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-non-co-re-tracee" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tracee" class="md-header__button md-logo" aria-label="Tracee" data-md-component="logo">
      
  <img src="../../images/tracee_logo_only.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tracee
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Building non CO-RE
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aquasecurity/tracee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tracee" class="md-nav__button md-logo" aria-label="Tracee" data-md-component="logo">
      
  <img src="../../images/tracee_logo_only.png" alt="logo">

    </a>
    Tracee
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aquasecurity/tracee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>

      </a>
    </li>
  

    
      
      
      


  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          
  
  <span class="md-ellipsis">
    Building
  </span>

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Building" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Building
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building Environment
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building Containers
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Building non CO-RE
  </span>

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Building non CO-RE
  </span>

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-need-for-a-non-co-re-ebpf-object-build" class="md-nav__link">
    The need for a non CO-RE eBPF object build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-non-co-re-ebpf-object" class="md-nav__link">
    Install the non CO-RE eBPF object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-tracee-ebpf-with-the-non-co-re-ebpf-object" class="md-nav__link">
    Run tracee-ebpf with the non CO-RE eBPF object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-the-building-environment" class="md-nav__link">
    Use the building environment
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      


  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          
  
  <span class="md-ellipsis">
    Installation
  </span>

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/prerequisites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prerequisites
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/headers.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Headers
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/docker-mac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker for Mac
  </span>

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrations
  </span>

      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Options
  </span>

      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../../rules-authoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authoring Rules
  </span>

      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../../rules-index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Available Rules
  </span>

      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>

      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>

      </a>
    </li>
  

    
      
      
      


  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          
  
  <span class="md-ellipsis">
    Tracing
  </span>

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tracing" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Tracing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tracee-ebpf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tracee-ebpf/output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Output Options
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tracee-ebpf/trace-options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace Options
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tracee-ebpf/capture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capturing Artifacts
  </span>

      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tracee-ebpf/override-os-needed-files" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overriding OS needed files
  </span>

      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-need-for-a-non-co-re-ebpf-object-build" class="md-nav__link">
    The need for a non CO-RE eBPF object build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-non-co-re-ebpf-object" class="md-nav__link">
    Install the non CO-RE eBPF object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-tracee-ebpf-with-the-non-co-re-ebpf-object" class="md-nav__link">
    Run tracee-ebpf with the non CO-RE eBPF object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-the-building-environment" class="md-nav__link">
    Use the building environment
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="running-non-co-re-tracee">Running non CO-RE Tracee<a class="headerlink" href="#running-non-co-re-tracee" title="Permanent link">&para;</a></h1>
<blockquote>
<p>These instructions are meant to describe how to build tracee's eBPF object
for your running kernel when it does not support
<a href="https://nakryiko.com/posts/bpf-portability-and-co-re/">CO-RE</a>.</p>
</blockquote>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Tracee consists of:</p>
<ul>
<li>tracee-ebpf:</li>
<li>Userspace agent - handles lifecycle of ebpf programs, receives events from eBPF programs</li>
<li>
<p>eBPF code - programs loaded into the kernel for data collection</p>
</li>
<li>
<p>tracee-rules:</p>
</li>
<li>OPA signatures</li>
<li>golang signatures</li>
</ul>
<p><code>tracee-ebpf</code> leverages Linux's eBPF technology, which requires some kernel
level integration. Tracee supports two eBPF integration modes:</p>
<ul>
<li>CO-RE: a <strong>portable mode</strong>, which will seamlessly run on all supported envs.</li>
</ul>
<p>The portable option, also known as CO-RE (compile once, run everywhere),
  requires that your operating system support <a href="https://nakryiko.com/posts/btf-dedup/">BTF</a>
  (BPF Type Format). Tracee will automatically run in CO-RE mode if it detects
  that the environment supports it. The <code>tracee-ebpf</code> binary has a CO-RE eBPF
  object embedded on it. When executed, it loads the CO-RE eBPF object into the
  kernel and each of its object's eBPF programs are executed when triggered by
  kernel probes, or tracepoints, for example.</p>
<p>This mode requires no intervention or preparation on your side.  You can
  manually detect if your environments supports it by checking if the following
  file exists on your machine: <code>/sys/kernel/btf/vmlinux</code>.</p>
<ul>
<li>non CO-RE: a <strong>kernel-specific mode</strong>, requiring eBPF object to be built.</li>
</ul>
<p>If you want to run Tracee on a host without BTF support, there are 2 options:</p>
<ol>
<li>
<p>to use BTF files from <a href="https://github.com/aquasecurity/btfhub">BTFhub</a> and
     provide the TRACEE_BTF_FILE environment variable pointing to the BTF file
     of your running kernel.</p>
</li>
<li>
<p>to have <code>../../Makefile.one</code> build and install the eBPF object for you
     (instructions in this file). This will depend on having clang and a kernel
     version specific kernel-header package.</p>
</li>
</ol>
<h2 id="the-need-for-a-non-co-re-ebpf-object-build">The need for a non CO-RE eBPF object build<a class="headerlink" href="#the-need-for-a-non-co-re-ebpf-object-build" title="Permanent link">&para;</a></h2>
<p>Until <a href="https://github.com/aquasecurity/tracee/commit/20549fabefa37b70ca1b8bade8ae39ef0b934942">recently</a>,
<code>tracee-ebpf</code> was capable of building a non CO-RE (portable) eBPF object when
the running kernel did not support BTF, one of the kernel features needed for
eBPF portability among different kernels.</p>
<p><strong>That now is changed</strong>:</p>
<p>It is the <strong>user responsibility</strong> to have the <em>non CO-RE eBPF object</em> correctly
placed in <code>/tmp/tracee</code> directory. Tracee will load it, instead of loading the
embedded CO-RE eBPF object, as a last resource if there is no:</p>
<ol>
<li>BTF file available in running kernel (<code>/sys/kernel/btf/vmlinux</code>).</li>
<li>BTF file pointed by <code>TRACEE_BTF_FILE</code> environment variable.</li>
<li>BTF file embedded into "tracee-ebpf" binary (<a href="https://github.com/aquasecurity/btfhub">BTFhub</a>).</li>
</ol>
<blockquote>
<p><strong>NOTE</strong>: Installing the non CO-RE eBPF object does not mean you will run
<code>tracee-ebpf</code> with it by default. It only means that if your running kernel
doesn't support CO-RE, it will be loaded. To force <code>tracee-ebpf</code> to always
run non CO-RE eBPF object you have to specific TRACEE_BPF_FILE= environment
variable.</p>
</blockquote>
<p><strong>Reasoning behind this change</strong></p>
<p>With <a href="https://github.com/aquasecurity/btfhub">BTFhub</a>, it is now possible to
run <code>tracee-ebpf</code> without compiling the eBPF object to each different kernel,
thus removing the automatic builds (although the functionality is still kept
through the Makefile).</p>
<h2 id="install-the-non-co-re-ebpf-object">Install the non CO-RE eBPF object<a class="headerlink" href="#install-the-non-co-re-ebpf-object" title="Permanent link">&para;</a></h2>
<p>By running:</p>
<div class="highlight"><pre><span></span><code>$ make -f Makefile.one clean
$ make -f Makefile.one all
$ make -f Makefile.one install-bpf-nocore
</code></pre></div>
<p>make installs an eBPF object file under <code>/tmp/tracee</code> for the current running
kernel. Example:</p>
<div class="highlight"><pre><span></span><code>$ find /tmp/tracee
/tmp/tracee
/tmp/tracee/tracee.bpf.5_4_0-91-generic.v0_6_5-80-ge723a22.o
</code></pre></div>
<blockquote>
<p><strong>NOTE</strong>: In this example, the Ubuntu Focal kernel <strong>5.4.0-91-generic</strong>
supports CO-RE, but the kernel does not have embedded BTF information
available. In cases like this, the user may opt to either use
<a href="https://github.com/aquasecurity/btfhub">BTFhub</a> btf files (with an
environment variable TRACEE_BTF_FILE=.../5.4.0-91-generic.btf) OR to install
the non CO-RE eBPF object and run <code>tracee-ebpf</code> command without an env
variable.</p>
</blockquote>
<h2 id="run-tracee-ebpf-with-the-non-co-re-ebpf-object">Run <code>tracee-ebpf</code> with the non CO-RE eBPF object<a class="headerlink" href="#run-tracee-ebpf-with-the-non-co-re-ebpf-object" title="Permanent link">&para;</a></h2>
<p>If you install the non CO-RE eBPF object and run <code>tracee-ebpf</code> in an
environment that needs it, then the debug output will look like:</p>
<div class="highlight"><pre><span></span><code>$ sudo ./dist/tracee-ebpf --debug --trace &#39;event!=sched*&#39;

OSInfo: ARCH: x86_64
OSInfo: VERSION: &quot;20.04.3 LTS (Focal Fossa)&quot;
OSInfo: ID: ubuntu
OSInfo: ID_LIKE: debian
OSInfo: PRETTY_NAME: &quot;Ubuntu 20.04.3 LTS&quot;
OSInfo: VERSION_ID: &quot;20.04&quot;
OSInfo: VERSION_CODENAME: focal
OSInfo: KERNEL_RELEASE: 5.8.0-63-generic
BTF: bpfenv = false, btfenv = false, vmlinux = false
BPF: no BTF file was found or provided, trying non CO-RE eBPF at
     /tmp/tracee/tracee.bpf.5_8_0-63-generic.v0_6_5-20-g3353501.o
</code></pre></div>
<p>You can see that <code>tracee-ebpf</code> was picked the file from <code>/tmp/tracee</code>
directory.</p>
<p>One way of forcing <code>tracee-ebpf</code> to use non CO-RE eBPF object, even in a kernel
that supports CO-RE, is by setting the <code>TRACEE_BPF_FILE</code> environment, like
this:</p>
<div class="highlight"><pre><span></span><code>$ sudo TRACEE_BPF_FILE=/tmp/tracee/tracee.bpf.5_4_0-91-generic.v0_6_5-80-ge723a22.o ./dist/tracee-ebpf --debug -o option:parse-arguments --trace comm=bash --trace follow --trace event!=&#39;sched*&#39;
OSInfo: PRETTY_NAME: &quot;Ubuntu 20.04.3 LTS&quot;
OSInfo: VERSION_ID: &quot;20.04&quot;
OSInfo: VERSION_CODENAME: focal
OSInfo: KERNEL_RELEASE: 5.4.0-91-generic
OSInfo: ARCH: x86_64
OSInfo: VERSION: &quot;20.04.3 LTS (Focal Fossa)&quot;
OSInfo: ID: ubuntu
OSInfo: ID_LIKE: debian
BTF: bpfenv = true, btfenv = false, vmlinux = false
BPF: using BPF object from environment: /tmp/tracee/tracee.bpf.5_4_0-91-generic.v0_6_5-80-ge723a22.o
TIME             UID    COMM             PID     TID     RET              EVENT                ARGS
...
</code></pre></div>
<h2 id="use-the-building-environment">Use the <a href="../environment/">building environment</a><a class="headerlink" href="#use-the-building-environment" title="Permanent link">&para;</a></h2>
<p>If you're willing to generate the non CO-RE eBPF object using the <code>tracee-make</code>
building environment container, you're able to by doing:</p>
<div class="highlight"><pre><span></span><code>$ make -f builder/Makefile.tracee-make alpine-prepare
$ make -f builder/Makefile.tracee-make alpine-shell
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>$ make -f builder/Makefile.tracee-make ubuntu-prepare
$ make -f builder/Makefile.tracee-make ubuntu-shell
</code></pre></div>
<p>and then, inside the docker container:</p>
<div class="highlight"><pre><span></span><code>tracee@f65bab137305[/tracee]$ make -f Makefile.one clean
tracee@f65bab137305[/tracee]$ make -f Makefile.one tracee-ebpf
tracee@f65bab137305[/tracee]$ make -f Makefile.one install-bpf-nocore

tracee@f65bab137305[/tracee]$ sudo ./dist/tracee-ebpf --debug --trace &#39;event!=sched*&#39;
KConfig: warning: could not check enabled kconfig features
(could not read /boot/config-5.8.0-63-generic: ...)
KConfig: warning: assuming kconfig values, might have unexpected behavior
OSInfo: KERNEL_RELEASE: 5.8.0-63-generic
OSInfo: ARCH: x86_64
OSInfo: VERSION: &quot;21.04 (Hirsute Hippo)&quot;
OSInfo: ID: ubuntu
OSInfo: ID_LIKE: debian
OSInfo: PRETTY_NAME: &quot;Ubuntu 21.04&quot;
OSInfo: VERSION_ID: &quot;21.04&quot;
OSInfo: VERSION_CODENAME: hirsute
BTF: bpfenv = false, btfenv = false, vmlinux = false
BPF: no BTF file was found or provided
BPF: trying non CO-RE eBPF at /tmp/tracee/tracee.bpf.5_8_0-63-generic.v0_6_5-20-g0b921b1.o
KConfig: warning: assuming kconfig values, might have unexpected behavior
TIME             UID    COMM             PID     TID     RET ...
</code></pre></div>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../containers/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Building Containers" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Building Containers
            </div>
          </div>
        </a>
      
      
        
        <a href="../../install/prerequisites/" class="md-footer__link md-footer__link--next" aria-label="Next: Prerequisites" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Prerequisites
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.f7fe2898.min.js", "version": {"method": "mike", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.03f8e4a4.min.js"></script>
      
    
  </body>
</html>