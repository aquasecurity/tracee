syntax = "proto3";

package tracee.v1beta1.datastores;

option go_package = "github.com/aquasecurity/tracee/api/v1beta1/datastores;datastores";

import "google/protobuf/any.proto";

// DataEntry represents a single key-value pair for writable datastores
// Keys and data are packed as google.protobuf.Any for type safety and extensibility
message DataEntry {
    google.protobuf.Any key = 1;   // Key as protobuf Any (e.g., IPAddressKey from ipreputation.proto)
    google.protobuf.Any data = 2;  // Data as protobuf Any (e.g., IPReputation from ipreputation.proto)
}

// gRPC service for writing data to datastores

message WriteDataRequest {
    string store_name = 1;  // Name of the target datastore
    string source = 2;      // Source identifier for this data
    DataEntry entry = 3;    // The data entry to write
}

message WriteDataResponse {
    // Empty response on success
}

message WriteBatchDataRequest {
    string store_name = 1;
    string source = 2;
    repeated DataEntry entries = 3;
}

message WriteBatchDataResponse {
    int32 written_count = 1;  // Number of entries successfully written
}

message DeleteDataRequest {
    string store_name = 1;
    string source = 2;
    google.protobuf.Any key = 3;  // Key remains separate for delete
}

message DeleteDataResponse {
    // Empty response on success
}

message ClearSourceRequest {
    string store_name = 1;
    string source = 2;  // Clear all data from this source
}

message ClearSourceResponse {
    int32 deleted_count = 1;  // Number of entries deleted
}

message ListSourcesRequest {
    string store_name = 1;
}

message ListSourcesResponse {
    repeated string sources = 1;
}

service DataStoreService {
    // Write a single data entry
    rpc WriteData(WriteDataRequest) returns (WriteDataResponse);

    // Write multiple data entries in a batch
    rpc WriteBatchData(WriteBatchDataRequest) returns (WriteBatchDataResponse);

    // Delete a data entry
    rpc DeleteData(DeleteDataRequest) returns (DeleteDataResponse);

    // Clear all data from a specific source
    rpc ClearSource(ClearSourceRequest) returns (ClearSourceResponse);

    // List all sources in a datastore
    rpc ListSources(ListSourcesRequest) returns (ListSourcesResponse);
}

